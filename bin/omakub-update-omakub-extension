#!/bin/bash

EXTENSION_UUID="omakub-menu-topbar@omakasui.org"
EXTENSION_DIR="$HOME/.local/share/gnome-shell/extensions/$EXTENSION_UUID"

# Check for Omakub custom extension update
if [ -d "$EXTENSION_DIR" ]; then
  CURRENT_VERSION=$(cat "$EXTENSION_DIR/metadata.json" | grep -oP '"version"\s*:\s*"\K[^"]+')
  LATEST_VERSION=$(curl -fsSL https://raw.githubusercontent.com/Kasui92/omakub-menu-topbar-extension/main/version)

  if [ "$CURRENT_VERSION" != "$LATEST_VERSION" ]; then
    echo "Updating Omakub Menu Topbar extension from $CURRENT_VERSION to $LATEST_VERSION..."
    curl -fsSL https://omakasui.org/omakub-menu-topbar-extension | bash
    omakub-state set logout-required
  fi
fi
